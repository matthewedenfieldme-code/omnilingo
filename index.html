<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Omnilingo ‚Äî Translate Everything</title>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;1,300&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet" />
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    :root {
      --bg: #f0f4fa; --surface: #ffffff; --surface2: #e8eef8; --border: #d0daf0;
      --accent: #3a6fd8; --accent-light: #6a9af0; --accent-pale: #dde8ff;
      --text: #1a2340; --text-soft: #5a6a8a; --text-muted: #8a9abf;
      --shadow-lg: 0 8px 48px rgba(58,111,216,0.14);
      --radius: 16px; --radius-sm: 10px;
    }
    body { font-family: 'DM Sans', sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; overflow-x: hidden; }
    body::before {
      content: ''; position: fixed; inset: 0;
      background: radial-gradient(ellipse 80% 50% at 20% -10%, rgba(106,154,240,0.18) 0%, transparent 60%),
        radial-gradient(ellipse 60% 40% at 80% 110%, rgba(58,111,216,0.12) 0%, transparent 60%);
      pointer-events: none; z-index: 0;
    }
    .container { position: relative; z-index: 1; max-width: 720px; margin: 0 auto; padding: 48px 20px 80px; }
    header { text-align: center; margin-bottom: 52px; animation: fadeDown 0.7s ease both; }
    .logo { font-family: 'Cormorant Garamond', serif; font-size: clamp(2.8rem, 8vw, 4.2rem); font-weight: 300; letter-spacing: -0.02em; color: var(--text); line-height: 1; }
    .logo span { color: var(--accent); font-style: italic; }
    .tagline { margin-top: 10px; font-size: 0.88rem; font-weight: 300; color: var(--text-muted); letter-spacing: 0.12em; text-transform: uppercase; }
    .card { background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius); padding: 36px; box-shadow: var(--shadow-lg); animation: fadeUp 0.7s 0.15s ease both; }
    .field-label { font-size: 0.75rem; font-weight: 500; letter-spacing: 0.1em; text-transform: uppercase; color: var(--text-muted); margin-bottom: 8px; }
    .input-wrap { position: relative; margin-bottom: 20px; }
    #wordInput { width: 100%; padding: 16px 52px 16px 18px; font-family: 'DM Sans', sans-serif; font-size: 1.05rem; color: var(--text); background: var(--surface); border: 1.5px solid var(--border); border-radius: var(--radius-sm); outline: none; transition: border-color 0.2s, box-shadow 0.2s; }
    #wordInput:focus { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(58,111,216,0.1); }
    #wordInput::placeholder { color: var(--text-muted); }
    .clear-btn { position: absolute; right: 14px; top: 50%; transform: translateY(-50%); background: none; border: none; color: var(--text-muted); cursor: pointer; font-size: 1.1rem; padding: 4px; border-radius: 50%; display: none; transition: color 0.2s; }
    .clear-btn:hover { color: var(--accent); }
    .lang-row { display: flex; gap: 12px; align-items: flex-end; margin-bottom: 24px; }
    .select-wrap { flex: 1; position: relative; }
    .select-wrap::after { content: '‚ñæ'; position: absolute; right: 14px; top: 50%; transform: translateY(-50%); color: var(--text-muted); pointer-events: none; font-size: 0.8rem; }
    select { width: 100%; padding: 14px 36px 14px 16px; font-family: 'DM Sans', sans-serif; font-size: 0.95rem; color: var(--text); background: var(--surface); border: 1.5px solid var(--border); border-radius: var(--radius-sm); outline: none; appearance: none; cursor: pointer; transition: border-color 0.2s; }
    select:focus { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(58,111,216,0.1); }
    .translate-btn { width: 100%; padding: 16px; background: var(--accent); color: white; border: none; border-radius: var(--radius-sm); font-family: 'DM Sans', sans-serif; font-size: 1rem; font-weight: 500; cursor: pointer; transition: background 0.2s, transform 0.1s; box-shadow: 0 4px 16px rgba(58,111,216,0.3); position: relative; overflow: hidden; }
    .translate-btn:hover { background: #2d5ec0; }
    .translate-btn:active { transform: scale(0.99); }
    .translate-btn.loading { pointer-events: none; }
    .btn-text { transition: opacity 0.2s; }
    .btn-spinner { display: none; position: absolute; inset: 0; align-items: center; justify-content: center; }
    .translate-btn.loading .btn-text { opacity: 0; }
    .translate-btn.loading .btn-spinner { display: flex; }
    .spinner { width: 20px; height: 20px; border: 2px solid rgba(255,255,255,0.3); border-top-color: white; border-radius: 50%; animation: spin 0.7s linear infinite; }
    #results { margin-top: 28px; display: none; animation: fadeUp 0.4s ease both; }
    .result-main { background: var(--accent-pale); border: 1px solid rgba(58,111,216,0.2); border-radius: var(--radius-sm); padding: 24px 26px; margin-bottom: 12px; }
    .result-label { font-size: 0.72rem; font-weight: 500; letter-spacing: 0.12em; text-transform: uppercase; color: var(--accent); margin-bottom: 8px; }
    .result-translation-row { display: flex; align-items: center; gap: 14px; }
    .result-translation { font-family: 'Cormorant Garamond', serif; font-size: clamp(1.8rem, 5vw, 2.4rem); font-weight: 300; color: var(--text); line-height: 1.2; flex: 1; }
    .result-phonetic { font-size: 0.85rem; color: var(--text-soft); margin-top: 8px; font-style: italic; line-height: 1.5; }
    .speak-btn { background: white; border: 1.5px solid var(--border); border-radius: 50%; width: 44px; height: 44px; min-width: 44px; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 1.1rem; transition: border-color 0.2s, background 0.2s, transform 0.15s; box-shadow: 0 2px 8px rgba(58,111,216,0.1); }
    .speak-btn:hover { border-color: var(--accent); background: var(--accent-pale); transform: scale(1.08); }
    .speak-btn:active { transform: scale(0.95); }
    .speak-btn.speaking { border-color: var(--accent); background: var(--accent); }
    .speak-btn.speaking span { filter: brightness(10); }
    .details-toggle { display: flex; align-items: center; gap: 8px; background: none; border: 1.5px solid var(--border); border-radius: var(--radius-sm); padding: 12px 18px; font-family: 'DM Sans', sans-serif; font-size: 0.88rem; color: var(--text-soft); cursor: pointer; width: 100%; transition: border-color 0.2s, color 0.2s, background 0.2s; margin-bottom: 12px; }
    .details-toggle:hover { border-color: var(--accent-light); color: var(--accent); background: var(--accent-pale); }
    .toggle-icon { margin-left: auto; transition: transform 0.3s; font-size: 0.8rem; }
    .details-toggle.open .toggle-icon { transform: rotate(180deg); }
    .details-panel { display: none; background: var(--surface2); border: 1px solid var(--border); border-radius: var(--radius-sm); overflow: hidden; margin-bottom: 12px; }
    .details-panel.open { display: block; animation: fadeUp 0.3s ease both; }
    .detail-section { padding: 20px 22px; border-bottom: 1px solid var(--border); }
    .detail-section:last-child { border-bottom: none; }
    .detail-section-title { font-size: 0.72rem; font-weight: 500; letter-spacing: 0.1em; text-transform: uppercase; color: var(--accent); margin-bottom: 8px; }
    .detail-text { font-size: 0.93rem; color: var(--text-soft); line-height: 1.65; }
    .detail-word { font-family: 'Cormorant Garamond', serif; font-size: 1.1rem; font-weight: 600; color: var(--text); margin-bottom: 4px; }
    .error-msg { background: #fff0f0; border: 1px solid #ffc0c0; border-radius: var(--radius-sm); padding: 14px 18px; color: #c03030; font-size: 0.9rem; margin-top: 16px; display: none; }
    footer { text-align: center; margin-top: 48px; font-size: 0.78rem; color: var(--text-muted); animation: fadeUp 0.7s 0.3s ease both; }
    @keyframes fadeDown { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes fadeUp { from { opacity: 0; transform: translateY(16px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes spin { to { transform: rotate(360deg); } }
    @media (max-width: 480px) { .card { padding: 24px 18px; } .lang-row { flex-direction: column; } .container { padding: 32px 14px 60px; } }
  </style>
</head>
<body>
<div class="container">
  <header>
    <div class="logo">Omni<span>lingo</span></div>
    <p class="tagline">Translate ¬∑ Define ¬∑ Discover</p>
  </header>
  <div class="card">
    <div class="input-wrap">
      <p class="field-label">Word or Phrase</p>
      <input type="text" id="wordInput" placeholder="Type a word or phrase‚Ä¶" autocomplete="off" spellcheck="false" />
      <button class="clear-btn" id="clearBtn" title="Clear">‚úï</button>
    </div>
    <div class="lang-row">
      <div class="select-wrap" style="flex:0 0 140px">
        <p class="field-label">From</p>
        <select id="fromLang"></select>
      </div>
      <div class="select-wrap">
        <p class="field-label">Translate To</p>
        <select id="toLang"></select>
      </div>
    </div>
    <button class="translate-btn" id="translateBtn">
      <span class="btn-text">Translate</span>
      <span class="btn-spinner"><span class="spinner"></span></span>
    </button>
    <div class="error-msg" id="errorMsg"></div>
    <div id="results">
      <div class="result-main">
        <div class="result-label" id="resultLangLabel">Translation</div>
        <div class="result-translation-row">
          <div style="flex:1">
            <div class="result-translation" id="resultText">‚Äî</div>
            <div class="result-phonetic" id="resultPhonetic" style="display:none"></div>
          </div>
          <button class="speak-btn" id="speakBtn" title="Hear pronunciation" style="display:none">
            <span>üîä</span>
          </button>
        </div>
      </div>
      <button class="details-toggle" id="detailsToggle">
        <span>üìñ Definitions, Origins &amp; More</span>
        <span class="toggle-icon">‚ñæ</span>
      </button>
      <div class="details-panel" id="detailsPanel">
        <div class="detail-section">
          <div class="detail-section-title">Original Word</div>
          <div class="detail-word" id="origWord"></div>
          <div class="detail-text" id="origDefinition"></div>
        </div>
        <div class="detail-section">
          <div class="detail-section-title">Word Origin &amp; Etymology</div>
          <div class="detail-text" id="wordEtymology"></div>
        </div>
        <div class="detail-section">
          <div class="detail-section-title">Translated Word</div>
          <div class="detail-word" id="transWord"></div>
          <div class="detail-text" id="transDefinition"></div>
        </div>
      </div>
    </div>
  </div>
  <footer>Powered by open translation &amp; dictionary APIs ¬∑ Omnilingo</footer>
</div>
<script>
const LANGUAGES=[["af","Afrikaans"],["sq","Albanian"],["am","Amharic"],["ar","Arabic"],["hy","Armenian"],["az","Azerbaijani"],["eu","Basque"],["be","Belarusian"],["bn","Bengali"],["bs","Bosnian"],["bg","Bulgarian"],["ca","Catalan"],["ceb","Cebuano"],["zh","Chinese (Simplified)"],["zh-TW","Chinese (Traditional)"],["co","Corsican"],["hr","Croatian"],["cs","Czech"],["da","Danish"],["nl","Dutch"],["en","English"],["eo","Esperanto"],["et","Estonian"],["fi","Finnish"],["fr","French"],["fy","Frisian"],["gl","Galician"],["ka","Georgian"],["de","German"],["el","Greek"],["gu","Gujarati"],["ht","Haitian Creole"],["ha","Hausa"],["haw","Hawaiian"],["he","Hebrew"],["hi","Hindi"],["hmn","Hmong"],["hu","Hungarian"],["is","Icelandic"],["ig","Igbo"],["id","Indonesian"],["ga","Irish"],["it","Italian"],["ja","Japanese"],["jv","Javanese"],["kn","Kannada"],["kk","Kazakh"],["km","Khmer"],["rw","Kinyarwanda"],["ko","Korean"],["ku","Kurdish"],["ky","Kyrgyz"],["lo","Lao"],["la","Latin"],["lv","Latvian"],["lt","Lithuanian"],["lb","Luxembourgish"],["mk","Macedonian"],["mg","Malagasy"],["ms","Malay"],["ml","Malayalam"],["mt","Maltese"],["mi","Maori"],["mr","Marathi"],["mn","Mongolian"],["my","Myanmar (Burmese)"],["ne","Nepali"],["no","Norwegian"],["ny","Nyanja"],["or","Odia"],["ps","Pashto"],["fa","Persian"],["pl","Polish"],["pt","Portuguese"],["pa","Punjabi"],["ro","Romanian"],["ru","Russian"],["sm","Samoan"],["gd","Scots Gaelic"],["sr","Serbian"],["st","Sesotho"],["sn","Shona"],["sd","Sindhi"],["si","Sinhala"],["sk","Slovak"],["sl","Slovenian"],["so","Somali"],["es","Spanish"],["su","Sundanese"],["sw","Swahili"],["sv","Swedish"],["tl","Tagalog"],["tg","Tajik"],["ta","Tamil"],["tt","Tatar"],["te","Telugu"],["th","Thai"],["tr","Turkish"],["tk","Turkmen"],["uk","Ukrainian"],["ur","Urdu"],["ug","Uyghur"],["uz","Uzbek"],["vi","Vietnamese"],["cy","Welsh"],["xh","Xhosa"],["yi","Yiddish"],["yo","Yoruba"],["zu","Zulu"]];

const WIKT_LANG_NAME={"af":"Afrikaans","sq":"Albanian","ar":"Arabic","hy":"Armenian","az":"Azerbaijani","eu":"Basque","bn":"Bengali","bs":"Bosnian","bg":"Bulgarian","ca":"Catalan","zh":"Chinese","hr":"Croatian","cs":"Czech","da":"Danish","nl":"Dutch","en":"English","et":"Estonian","fi":"Finnish","fr":"French","gl":"Galician","ka":"Georgian","de":"German","el":"Greek","he":"Hebrew","hi":"Hindi","hu":"Hungarian","is":"Icelandic","id":"Indonesian","ga":"Irish","it":"Italian","ja":"Japanese","kn":"Kannada","ko":"Korean","lv":"Latvian","lt":"Lithuanian","mk":"Macedonian","ms":"Malay","ml":"Malayalam","mr":"Marathi","ne":"Nepali","no":"Norwegian","fa":"Persian","pl":"Polish","pt":"Portuguese","ro":"Romanian","ru":"Russian","sr":"Serbian","sk":"Slovak","sl":"Slovenian","es":"Spanish","sw":"Swahili","sv":"Swedish","ta":"Tamil","te":"Telugu","th":"Thai","tr":"Turkish","uk":"Ukrainian","ur":"Urdu","uz":"Uzbek","vi":"Vietnamese","cy":"Welsh","yo":"Yoruba","zu":"Zulu","la":"Latin","eo":"Esperanto","haw":"Hawaiian","mi":"Maori","tl":"Tagalog"};

const SPEECH_LANG_MAP={"af":"af-ZA","sq":"sq-AL","ar":"ar-SA","hy":"hy-AM","az":"az-AZ","eu":"eu-ES","bn":"bn-BD","bs":"bs-BA","bg":"bg-BG","ca":"ca-ES","zh":"zh-CN","zh-TW":"zh-TW","hr":"hr-HR","cs":"cs-CZ","da":"da-DK","nl":"nl-NL","en":"en-US","et":"et-EE","fi":"fi-FI","fr":"fr-FR","gl":"gl-ES","ka":"ka-GE","de":"de-DE","el":"el-GR","gu":"gu-IN","he":"he-IL","hi":"hi-IN","hu":"hu-HU","is":"is-IS","id":"id-ID","ga":"ga-IE","it":"it-IT","ja":"ja-JP","kn":"kn-IN","kk":"kk-KZ","km":"km-KH","ko":"ko-KR","ky":"ky-KG","lo":"lo-LA","lv":"lv-LV","lt":"lt-LT","mk":"mk-MK","ms":"ms-MY","ml":"ml-IN","mt":"mt-MT","mr":"mr-IN","mn":"mn-MN","my":"my-MM","ne":"ne-NP","no":"no-NO","fa":"fa-IR","pl":"pl-PL","pt":"pt-BR","pa":"pa-IN","ro":"ro-RO","ru":"ru-RU","sr":"sr-RS","si":"si-LK","sk":"sk-SK","sl":"sl-SI","es":"es-ES","sw":"sw-KE","sv":"sv-SE","tl":"fil-PH","ta":"ta-IN","te":"te-IN","th":"th-TH","tr":"tr-TR","uk":"uk-UA","ur":"ur-PK","uz":"uz-UZ","vi":"vi-VN","cy":"cy-GB","yo":"yo-NG","zu":"zu-ZA"};

const PHONETIC_GUIDES={
  "es":"Pronunciation tip: Vowels are always pure ‚Äî A='ah', E='eh', I='ee', O='oh', U='oo'. J sounds like 'h'. LL sounds like 'y'.",
  "fr":"Pronunciation tip: Final consonants are often silent. OU='oo', EU='uh'. H is silent. EN/AN/IN are nasal sounds.",
  "de":"Pronunciation tip: W sounds like 'v'. V sounds like 'f'. Z sounds like 'ts'. IE='ee', EI='eye', EU='oy'. CH is guttural.",
  "it":"Pronunciation tip: Vowels are pure like Spanish. C before E/I sounds like 'ch'. G before E/I sounds like 'j'. GN='ny'.",
  "pt":"Pronunciation tip: LH='ly', NH='ny'. √ÉO sounds like 'owng'. Some vowels are nasal. S between vowels sounds like 'z'.",
  "ru":"Pronunciation tip: Stress changes vowel sounds. Unstressed O sounds like 'uh'. Soft consonants are followed by a 'y' glide.",
  "ar":"Pronunciation tip: Guttural sounds from the throat. Long vowels are held twice as long. Emphatic consonants change nearby vowels.",
  "ja":"Pronunciation tip: Each syllable has equal length. Vowels are pure. R is between English R and L. U is often barely voiced.",
  "zh":"Pronunciation tip: Tones change meaning (4 tones). X='sh', Q='ch', ZH='j'. Pinyin shown is a romanization guide.",
  "ko":"Pronunciation tip: Vowels are pure. Double consonants are tense/strong. G/D/B soften between vowels.",
  "hi":"Pronunciation tip: Aspirated consonants (KH, GH) have a puff of air. Retroflex consonants use tongue curled back.",
  "tr":"Pronunciation tip: Very phonetic ‚Äî pronounced as written. ≈û='sh', √á='ch', ƒû silently lengthens the previous vowel.",
  "pl":"Pronunciation tip: ≈Å sounds like 'w'. Sz='sh', Cz='ch', ≈π/≈ª='zh'. ƒÑ and ƒò are nasal vowels.",
  "nl":"Pronunciation tip: G is guttural like Scottish 'loch'. IJ sounds like 'eye'. OE='oo', UI is a unique Dutch sound.",
  "sv":"Pronunciation tip: Sj/Sk before E/I/Y sounds like 'sh'. Long vowels are held longer. Tone distinguishes some words.",
  "el":"Pronunciation tip: Letters always have the same sound. Y/H both sound like 'ee'. AU='av'/'af'. EU='ev'/'ef'.",
  "he":"Pronunciation tip: Read right to left. R is guttural. CH is like Scottish 'loch'. Most vowels are not written.",
  "uk":"Pronunciation tip: –ò sounds like a short 'i'. –Ü sounds like 'ee'. –ì is softer than Russian.",
  "vi":"Pronunciation tip: Six tones change meaning. D in north sounds like 'z'. ƒê sounds like 'd'. NH='ny', KH='kh'.",
  "th":"Pronunciation tip: Five tones change meaning. Aspirated and unaspirated consonants are distinct.",
  "id":"Pronunciation tip: Very phonetic. C sounds like 'ch'. Stress usually on second-to-last syllable. No tones.",
  "ms":"Pronunciation tip: Similar to Indonesian. C='ch'. Fairly phonetic. Stress on second-to-last syllable.",
  "haw":"Pronunciation tip: Vowels are pure ‚Äî A='ah', E='eh', I='ee', O='oh', U='oo'. Every vowel is pronounced. ' (okina) is a short pause. Stress usually on second-to-last syllable.",
  "mi":"Pronunciation tip: Vowels are pure like Hawaiian. WH sounds like 'f' in some dialects. Every letter is pronounced.",
  "sw":"Pronunciation tip: Very phonetic ‚Äî pronounced as written. Stress on second-to-last syllable. Vowels are pure.",
  "la":"Pronunciation tip: Vowels are pure. C is always hard like 'k'. V sounds like 'w'. AE sounds like 'eye'.",
  "eo":"Pronunciation tip: Perfectly phonetic ‚Äî every letter has one sound. C='ts', ƒà='ch', ƒú='j', ƒ¥='zh', ≈ú='sh'.",
  "tl":"Pronunciation tip: Vowels are pure. NG can appear at the start of words. Stress varies and changes meaning.",
  "ro":"Pronunciation tip: ƒÇ sounds like a short 'uh'. √Ç/√é sounds like a deep 'uh'. »ò='sh', »ö='ts'.",
  "hu":"Pronunciation tip: CS='ch', SZ='s', ZS='zh', GY='dy', NY='ny'. Stress always on first syllable.",
  "cs":"Pronunciation tip: ƒå='ch', ≈†='sh', ≈Ω='zh', ≈ò is a unique rolled+buzzing sound. Stress on first syllable.",
  "uk":"Pronunciation tip: –ò sounds like short 'i'. –Ü sounds like 'ee'. –ì is softer than Russian –ì.",
  "da":"Pronunciation tip: D between vowels sounds like 'th'. Soft D (√∞) at end of words. St√∏d is a glottal catch on some vowels.",
  "fi":"Pronunciation tip: Double letters are held longer. Vowels are pure. Y sounds like German √ú. Stress on first syllable.",
  "is":"Pronunciation tip: Ll sounds like 'tl'. Hn/Hm/Hr are voiceless. √Å='ow', √â='ye', √ç/√ù='ee', √ì='oh', √ö='oo'.",
};

// Clean Wiktionary response ‚Äî strip HTML tags, CSS, and junk
function cleanWiktDef(text) {
  if(!text) return null;
  // Remove CSS blocks like .mw-parser-output ...{...}
  text = text.replace(/\.[\w-]+\s*\{[^}]*\}/g, '');
  // Remove HTML tags
  text = text.replace(/<[^>]+>/g, '');
  // Remove multiple spaces/newlines
  text = text.replace(/\s+/g, ' ').trim();
  // Remove leftover CSS artifacts
  text = text.replace(/\.[a-z][\w-]*\{[^}]*\}/gi, '');
  text = text.replace(/font-size:\s*[\w.]+;?/gi, '');
  text = text.replace(/\.[a-zA-Z][\w-]*/g, '');
  // Decode HTML entities
  text = text.replace(/&amp;/g,'&').replace(/&lt;/g,'<').replace(/&gt;/g,'>').replace(/&quot;/g,'"').replace(/&#39;/g,"'");
  return text.trim() || null;
}

const fromLang=document.getElementById('fromLang'),toLang=document.getElementById('toLang'),
  wordInput=document.getElementById('wordInput'),clearBtn=document.getElementById('clearBtn'),
  translateBtn=document.getElementById('translateBtn'),results=document.getElementById('results'),
  errorMsg=document.getElementById('errorMsg'),detailsToggle=document.getElementById('detailsToggle'),
  detailsPanel=document.getElementById('detailsPanel'),speakBtn=document.getElementById('speakBtn'),
  resultPhonetic=document.getElementById('resultPhonetic');

LANGUAGES.forEach(([code,name])=>{
  fromLang.innerHTML+=`<option value="${code}">${name}</option>`;
  toLang.innerHTML+=`<option value="${code}">${name}</option>`;
});
fromLang.value='en'; toLang.value='es';

wordInput.addEventListener('input',()=>{ clearBtn.style.display=wordInput.value?'block':'none'; });
clearBtn.addEventListener('click',()=>{ wordInput.value=''; clearBtn.style.display='none'; results.style.display='none'; errorMsg.style.display='none'; wordInput.focus(); });
wordInput.addEventListener('keydown',e=>{ if(e.key==='Enter') translateBtn.click(); });

let currentTranslation='', currentToLang='';

speakBtn.addEventListener('click',()=>{
  if(!currentTranslation) return;
  if(window.speechSynthesis.speaking){ window.speechSynthesis.cancel(); speakBtn.classList.remove('speaking'); return; }
  const speechCode=SPEECH_LANG_MAP[currentToLang]||currentToLang;
  const utter=new SpeechSynthesisUtterance(currentTranslation);
  utter.lang=speechCode; utter.rate=0.85;
  utter.onstart=()=>speakBtn.classList.add('speaking');
  utter.onend=()=>speakBtn.classList.remove('speaking');
  utter.onerror=()=>speakBtn.classList.remove('speaking');
  window.speechSynthesis.speak(utter);
});

translateBtn.addEventListener('click',async()=>{
  const text=wordInput.value.trim();
  if(!text){ wordInput.focus(); return; }
  const from=fromLang.value, to=toLang.value;
  const toLangName=LANGUAGES.find(l=>l[0]===to)?.[1]||to;

  errorMsg.style.display='none'; results.style.display='none';
  translateBtn.classList.add('loading');
  if(window.speechSynthesis.speaking) window.speechSynthesis.cancel();
  speakBtn.classList.remove('speaking');

  try {
    const transRes=await fetch(`https://api.mymemory.translated.net/get?q=${encodeURIComponent(text)}&langpair=${from}|${to}`);
    const transData=await transRes.json();
    if(transData.responseStatus!==200&&transData.responseStatus!=='200') throw new Error('Translation failed. Please try again.');

    const translation=transData.responseData.translatedText;
    currentTranslation=translation; currentToLang=to;

    document.getElementById('resultLangLabel').textContent=`${toLangName} Translation`;
    document.getElementById('resultText').textContent=translation;
    document.getElementById('origWord').textContent=text;
    document.getElementById('transWord').textContent=translation;
    document.getElementById('origDefinition').textContent='Tap "Definitions, Origins & More" to load.';
    document.getElementById('wordEtymology').textContent='Tap above to load.';
    document.getElementById('transDefinition').textContent='Tap above to load.';

    // Phonetic guide
    const guide=PHONETIC_GUIDES[to];
    if(guide){ resultPhonetic.textContent='üí° '+guide; resultPhonetic.style.display='block'; }
    else { resultPhonetic.style.display='none'; }

    speakBtn.style.display=('speechSynthesis' in window)?'flex':'none';
    results.style.display='block';
    detailsToggle.classList.remove('open'); detailsPanel.classList.remove('open');

    let loaded=false;
    detailsToggle.onclick=async()=>{
      detailsToggle.classList.toggle('open'); detailsPanel.classList.toggle('open');
      if(!loaded&&detailsPanel.classList.contains('open')){ loaded=true; await loadDetails(text,translation,from,to); }
    };
  } catch(err) {
    errorMsg.textContent=err.message||'Something went wrong.';
    errorMsg.style.display='block';
  } finally {
    translateBtn.classList.remove('loading');
  }
});

async function getWiktionaryDef(word, langCode) {
  if(word.includes(' ')) return null;
  try {
    const res=await fetch(`https://en.wiktionary.org/api/rest_v1/page/definition/${encodeURIComponent(word.toLowerCase())}`);
    if(!res.ok) return null;
    const data=await res.json();
    const langName=WIKT_LANG_NAME[langCode]||null;
    let entries=null;
    if(langName && data[langName]) entries=data[langName];
    else if(langCode==='en' && data['English']) entries=data['English'];
    else { const keys=Object.keys(data); if(keys.length>0) entries=data[keys[0]]; }
    if(!entries||!entries.length) return null;
    let defText='';
    entries.slice(0,3).forEach(entry=>{
      if(entry.partOfSpeech && entry.definitions && entry.definitions[0]){
        const raw=entry.definitions[0].definition||'';
        const cleaned=cleanWiktDef(raw);
        if(cleaned) defText+=`(${entry.partOfSpeech}) ${cleaned}\n`;
      }
    });
    return defText.trim()||null;
  } catch { return null; }
}

async function loadDetails(original,translated,fromCode,toCode){
  const isEn=fromCode==='en', singleOrig=!original.includes(' '), singleTrans=!translated.includes(' ');

  document.getElementById('origDefinition').textContent='Loading‚Ä¶';
  document.getElementById('wordEtymology').textContent='Loading‚Ä¶';
  document.getElementById('transDefinition').textContent='Loading‚Ä¶';

  // Original word
  if(isEn && singleOrig){
    try{
      const res=await fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${encodeURIComponent(original.toLowerCase())}`);
      const data=await res.json();
      if(Array.isArray(data)&&data[0]){
        const meanings=data[0].meanings||[]; let defText='';
        meanings.slice(0,2).forEach(m=>{ const d=m.definitions?.[0]?.definition; if(d) defText+=`(${m.partOfSpeech}) ${d}\n`; });
        document.getElementById('origDefinition').textContent=defText.trim()||'No definition found.';
        document.getElementById('wordEtymology').textContent=data[0].origin||'Etymology not available for this word.';
      } else {
        document.getElementById('origDefinition').textContent='No definition found.';
        document.getElementById('wordEtymology').textContent='Etymology not available.';
      }
    } catch {
      document.getElementById('origDefinition').textContent='Could not load definition.';
      document.getElementById('wordEtymology').textContent='Could not load etymology.';
    }
  } else if(singleOrig){
    const def=await getWiktionaryDef(original,fromCode);
    document.getElementById('origDefinition').textContent=def||'No definition found for this word.';
    document.getElementById('wordEtymology').textContent='Etymology available for English words only.';
  } else {
    document.getElementById('origDefinition').textContent='Definitions available for single words only.';
    document.getElementById('wordEtymology').textContent='Etymology available for single English words.';
  }

  // Translated word
  if(singleTrans){
    const def=await getWiktionaryDef(translated,toCode);
    if(def){
      document.getElementById('transDefinition').textContent=def;
    } else if(toCode==='en'){
      try{
        const res=await fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${encodeURIComponent(translated.toLowerCase())}`);
        const data=await res.json();
        if(Array.isArray(data)&&data[0]){
          const meanings=data[0].meanings||[]; let defText='';
          meanings.slice(0,2).forEach(m=>{ const d=m.definitions?.[0]?.definition; if(d) defText+=`(${m.partOfSpeech}) ${d}\n`; });
          document.getElementById('transDefinition').textContent=defText.trim()||'No definition found.';
        } else { document.getElementById('transDefinition').textContent='No definition found.'; }
      } catch { document.getElementById('transDefinition').textContent='Could not load definition.'; }
    } else {
      document.getElementById('transDefinition').textContent='No definition found. Coverage varies by language.';
    }
  } else {
    document.getElementById('transDefinition').textContent='Definitions available for single words only.';
  }
}
</script>
</body>
</html>
